<view class="container">
  <!-- Hidden Canvas for Image Processing -->
  <canvas type="2d" id="processCanvas" style="position:fixed; left:100%; width: 1024px; height: 1024px;"></canvas>

  <view class="header">
    <text class="title">èŒå® è¡¨æƒ…åŒ…å·¥åŠ</text>
    <text class="subtitle">Zä¸–ä»£çš„å® ç‰©é»‘ç§‘æŠ€ âš¡ï¸</text>
  </view>

  <!-- Hero Stage: Smart Display Logic -->
  <view class="card hero-stage-card">
    <view class="image-wrapper {{!originalImage ? 'clickable' : ''}}" bindtap="onHeroTap">
      
      <!-- Display Image (simple binding) -->
      <image 
        class="hero-image" 
        src="{{displayImage}}" 
        mode="aspectFit" 
        wx:if="{{displayImage}}">
      </image>
      
      <!-- Empty State Trigger -->
      <view class="placeholder" wx:else>
        <text class="placeholder-icon">ğŸ“·</text>
        <text class="placeholder-text">ç‚¹å‡»ä¸Šä¼ ä¸»å­ç¾ç…§</text>
      </view>
      
      <!-- Loading Overlay -->
      <view class="loading-overlay" wx:if="{{isGenerating}}">
        <view class="loading-content">
          <text class="loading-spinner">ğŸŒ€</text>
          <text class="loading-text">{{loadingText}}</text>
        </view>
      </view>

      <!-- Floating Swap Button (always visible when image exists) -->
      <view class="swap-btn" catchtap="onSwapTap" wx:if="{{originalImage && !isGenerating}}">ğŸ”„</view>
    </view>
  </view>

  <!-- Control Panel -->
  <view class="card control-card">
    
    <!-- Style Selector - Now with clickable tags -->
    <view class="style-selector {{!processedImage ? 'disabled' : ''}}">
      <text class="section-title">âœ¨ é€‰æ‹©ç”»é£</text>
      <view class="style-tag-group">
        <view 
          class="style-tag {{currentStyle === item.value ? 'selected' : ''}}" 
          wx:for="{{styles}}" 
          wx:key="value"
          data-style="{{item.value}}"
          bindtap="onStyleTap">
          <text class="style-name">{{item.name}}</text>
          <!-- Cache indicator -->
          <text class="cache-dot" wx:if="{{styleCache[item.value]}}">âœ“</text>
        </view>
      </view>
    </view>

    <!-- Actions Area -->
    <view class="action-area">
      <!-- Generate Button - Only enabled if no cache for current style -->
      <button 
        class="btn generate-btn" 
        bindtap="generateMeme" 
        disabled="{{!processedImage || hasGenerated || isGenerating}}">
        <text>{{hasGenerated ? 'âœ… å·²ç”Ÿæˆ' : 'ğŸš€ ä¸€é”®ç”Ÿæˆ'}}</text>
      </button>

      <!-- Save Button - Only visible when current style has cached result -->
      <button 
        class="btn save-btn" 
        bindtap="saveImage" 
        wx:if="{{hasGenerated}}">
        <text>ğŸ’¾ ä¿å­˜åˆ°ç›¸å†Œ</text>
      </button>
    </view>
  </view>

</view>
