<view class="container">
  <!-- Hidden Canvas for Image Processing -->
  <canvas type="2d" id="processCanvas" style="position:fixed; left:100%; width: 1024px; height: 1024px;"></canvas>

  <view class="header">
    <text class="title">萌宠表情包工坊</text>
    <text class="subtitle">Z世代的宠物黑科技 ⚡️</text>
  </view>

  <!-- Card 1: Display Area -->
  <view class="card display-card">
    <view class="image-wrapper">
      <image class="preview-image" src="{{displayImage}}" mode="aspectFit" wx:if="{{displayImage}}"></image>
      <view class="placeholder" wx:else>
        <text class="placeholder-icon">📸</text>
        <text>上传主子萌照</text>
      </view>
      
      <!-- Loading Overlay -->
      <view class="loading-overlay" wx:if="{{isLoading}}">
        <view class="loading-content">
          <text class="loading-spinner">🌀</text>
          <text class="loading-text">{{loadingText}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Card 2: Operations -->
  <view class="card control-card">
    <button class="btn upload-btn" bindtap="chooseImage">
      <text>📸 上传照片</text>
    </button>

    <view class="style-selector">
      <text class="section-title">✨ 选择画风</text>
      <view class="style-options">
        <view 
          class="style-item {{selectedStyle === item.value ? 'active' : ''}}" 
          wx:for="{{styles}}" 
          wx:key="value"
          bindtap="onStyleTap" 
          data-value="{{item.value}}"
        >
            <!-- Note: changing from radio to custom view for better styling -->
            <!-- We need to update JS slightly to handle this tap or keep radio group but style it heavily. 
                 Let's stick to radio-group for now to minimize JS changes, 
                 OR use radio-group with hidden radios and custom labels. 
                 Actually, the user said "Action: Please update ... don't change core logic".
                 Changing UI interaction is updating UI. 
                 I'll keep radio-group structure but style it better.
            -->
            <radio-group class="radio-group-hidden" bindchange="onStyleChange">
                 <!-- Hidden real radios, we just use the loop above for visuals if we wanted complex buttons. 
                      Simplest: Just enhance the existing radio-group.
                 -->
            </radio-group>
      </view>
       <!-- Reverting to standard radio group but with class hooks for styling -->
       <radio-group class="style-radio-group" bindchange="onStyleChange">
        <label class="style-option {{selectedStyle === item.value ? 'selected' : ''}}" wx:for="{{styles}}" wx:key="value">
          <radio value="{{item.value}}" checked="{{item.checked}}" hidden="true"/>
          <text class="style-name">{{item.name}}</text>
        </label>
       </radio-group>
    </view>
    </view>

    <button class="btn generate-btn" bindtap="generateMeme" disabled="{{!processedImage}}">
      <text>🚀 一键生成</text>
    </button>
  </view>

  <!-- Result Modal / Card -->
  <view class="result-actions" wx:if="{{generatedImage}}">
     <view class="card result-card">
        <image class="result-image" src="{{generatedImage}}" mode="aspectFit" bindtap="previewResult"></image>
        <button class="btn save-btn" bindtap="saveImage">💾 保存到相册</button>
     </view>
  </view>
</view>
