<view class="container">
  <!-- Hidden Canvas for Image Processing -->
  <canvas type="2d" id="processCanvas" style="position:fixed; left:100%; width: 1024px; height: 1024px;"></canvas>

  <view class="header">
    <text class="title">萌宠表情包工坊</text>
    <text class="subtitle">Z世代的宠物黑科技 ⚡️</text>
  </view>

  <!-- Hero Stage: Combined Display & Upload Trigger -->
  <view class="card hero-stage-card">
    <view class="image-wrapper {{!processedImage ? 'clickable' : ''}}" bindtap="onHeroTap">
      <image class="hero-image" src="{{displayImage}}" mode="aspectFit" wx:if="{{displayImage}}"></image>
      
      <!-- Empty State Trigger -->
      <view class="placeholder" wx:else>
        <text class="placeholder-icon">📷</text>
        <text class="placeholder-text">点击上传主子美照</text>
      </view>
      
      <!-- Loading Overlay -->
      <view class="loading-overlay" wx:if="{{isLoading}}">
        <view class="loading-content">
          <text class="loading-spinner">🌀</text>
          <text class="loading-text">{{loadingText}}</text>
        </view>
      </view>

      <!-- Re-upload Hint (Optional, subtle overlay on image) -->
      <view class="reupload-hint" wx:if="{{displayImage && !isLoading && !isGenerated}}">
        <text>点击更换图片</text>
      </view>
    </view>
  </view>

  <!-- Control Panel -->
  <view class="card control-card">
    
    <!-- Style Selector -->
    <view class="style-selector {{!processedImage ? 'disabled' : ''}}">
      <text class="section-title">✨ 选择画风</text>
      <radio-group class="style-radio-group" bindchange="onStyleChange">
        <label class="style-option {{selectedStyle === item.value ? 'selected' : ''}}" wx:for="{{styles}}" wx:key="value">
          <radio value="{{item.value}}" checked="{{item.checked}}" hidden="true"/>
          <text class="style-name">{{item.name}}</text>
        </label>
      </radio-group>
    </view>

    <!-- Actions Area -->
    <view class="action-area">
      <button class="btn generate-btn" bindtap="generateMeme" disabled="{{!processedImage || isGenerated}}">
        <text>{{isGenerated ? '✅ 生成完毕' : '🚀 一键生成'}}</text>
      </button>

      <button class="btn save-btn" bindtap="saveImage" wx:if="{{isGenerated}}">
        <text>💾 保存到相册</text>
      </button>
    </view>
  </view>

</view>
