<view class="container">
  <!-- Hidden Canvas for Image Processing -->
  <canvas type="2d" id="processCanvas" style="position:fixed; left:100%; width: 1024px; height: 1024px;"></canvas>

  <!-- 🎨 Header with catchy slogan -->
  <view class="header">
    <text class="title">表情包制造机 🤪</text>
    <text class="subtitle">一秒变身沙雕艺术家</text>
  </view>

  <!-- Hero Stage -->
  <view class="card hero-stage-card">
    <view class="image-wrapper {{!originalImage ? 'clickable' : ''}}" bindtap="onHeroTap">
      
      <!-- Display Image -->
      <image 
        class="hero-image" 
        src="{{displayImage}}" 
        mode="aspectFit" 
        wx:if="{{displayImage}}">
      </image>
      
      <!-- Empty State -->
      <view class="placeholder" wx:else>
        <text class="placeholder-icon">📸</text>
        <text class="placeholder-text">戳我上传你的主子</text>
        <text class="placeholder-hint">支持喵星人/汪星人/人类</text>
      </view>
      
      <!-- Loading Overlay -->
      <view class="loading-overlay" wx:if="{{isGenerating}}">
        <view class="loading-content">
          <text class="loading-spinner">✨</text>
          <text class="loading-text">{{loadingText}}</text>
        </view>
      </view>

      <!-- Floating Swap Button -->
      <view class="swap-btn" catchtap="onSwapTap" wx:if="{{originalImage && !isGenerating}}">
        <text>🔄</text>
      </view>
    </view>
  </view>

  <!-- Control Panel -->
  <view class="card control-card">
    
    <!-- Style Selector -->
    <view class="style-selector {{!processedImage ? 'disabled' : ''}}">
      <text class="section-title">🎨 选择滤镜风格</text>
      <view class="style-tag-group">
        <view 
          class="style-tag {{currentStyle === item.value ? 'selected' : ''}}" 
          wx:for="{{styles}}" 
          wx:key="value"
          data-style="{{item.value}}"
          bindtap="onStyleTap">
          <text class="style-name">{{item.name}}</text>
          <text class="cache-dot" wx:if="{{styleCache[item.value]}}">✓</text>
        </view>
      </view>
    </view>


  </view>

  <!-- Footer hint -->
  <view class="footer">
    <text class="footer-text">✨ 每种风格独立生成，可以都试试哦~</text>
  </view>

  <!-- Fixed Bottom Bar -->
  <view class="bottom-bar">
    <!-- State A: Start Button -->
    <button 
      wx:if="{{!hasGenerated}}"
      class="btn generate-btn full-width" 
      bindtap="generateMeme" 
      disabled="{{!processedImage || isGenerating}}">
      <text>{{isGenerating ? '处理中...' : '🚀 开始整活'}}</text>
    </button>

    <!-- State B: Result Actions -->
    <view class="btn-group" wx:else>
      <button class="btn restart-btn" bindtap="onRestartTap">
        <text>🔄 重来</text>
      </button>
      <button class="btn save-btn" bindtap="saveImage">
        <text>💾 保存</text>
      </button>
    </view>
  </view>

</view>
